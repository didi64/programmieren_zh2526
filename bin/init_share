#!/bin/bash

set -euo pipefail

owner='dpro-prog2425zh'
root="${HOME}/work"
share_dir="${root}/share"
exceptions="${root}/.src/data/doppelte_vornamen.txt"

token=$(cat "$root/.token_share")
user=$(cat "$root/.user")
name=(${user//./ })
fname=${name[0]}
lname=${name[1]}

if [[ -d "$share_dir" ]]; then
    echo "share folder already exists"
    exit 1
fi

if grep -q -F "$name" "$exceptions"; then
    Lname=${lname^}
    repo="${fname}${Lname:0:1}"_share
else
    repo="${fname}_share"
fi

git -C "$root" clone --recurse-submodules "https://${owner}:${token}@github.com/${owner}/${repo}.git" share
git -C ${share_dir} config --local user.email "${user}@edu.teko.ch"
git -C ${share_dir} config --local user.name "${fname} ${lname}"
git -C ${share_dir}/.response switch main
git -C ${share_dir}/.response config --local pull.rebase false

mkdir -p ${share_dir}/response
